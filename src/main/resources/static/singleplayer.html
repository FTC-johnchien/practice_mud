<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Modern MUD Mobile (Single Player)</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/ansi_up@5.1.0/ansi_up.min.js"></script>
</head>
<body>

  <div class="game-container">
    <div class="status-header">
      <div>
        <div style="font-size: 12px;">HP: <span id="hp-val">0/0</span></div>
        <div class="bar-container"><div id="hp-bar" class="bar-fill hp-fill" style="width: 0%"></div></div>
      </div>
      <div>
        <div style="font-size: 12px;">MP: <span id="mp-val">0/0</span></div>
        <div class="bar-container"><div id="mp-bar" class="bar-fill mp-fill" style="width: 0%"></div></div>
      </div>
    </div>

    <div id="log"></div>

    <div class="mobile-panel">
      <div class="quick-actions">
        <button onclick="send('sc')">狀態</button>
        <button onclick="send('i')">物品</button>
        <button onclick="send('get all')">全撿</button>
        <button onclick="send('skills')">技能</button>
        <button onclick="send('rest')">休息</button>
        <button onclick="send('sit')">坐下</button>
      </div>
      <div class="direction-pad">
        <button class="dir-btn" onclick="send('nw')">↖</button>
        <button class="dir-btn" onclick="send('n')">N</button>
        <button class="dir-btn" onclick="send('ne')">↗</button>
        <button class="dir-btn" onclick="send('w')">W</button>
        <button class="dir-btn center-btn" onclick="send('l')">👁️</button>
        <button class="dir-btn" onclick="send('e')">E</button>
        <button class="dir-btn" onclick="send('sw')">↙</button>
        <button class="dir-btn" onclick="send('s')">S</button>
        <button class="dir-btn" onclick="send('se')">↘</button>
      </div>
    </div>

    <div class="input-bar">
      <input type="text" id="cmd-input" placeholder="輸入指令..." autocomplete="off" autofocus>
      <button onclick="handleEnter()" style="margin-left: 5px; padding: 0 15px;">發送</button>
    </div>
  </div>

  <script src="js/mud-core.js"></script>
  <script src="js/mud-ui.js"></script>

  <script>
    /**
     * 覆蓋通用 send 函數，改為與 Java 後端通訊
     */
    function send(cmd) {
      if (!cmd) return;

      // 檢查 JavaFX 注入的物件 (例如 JSConnector)
      if (window.javaConnector) {
        const msg = JSON.stringify({ type: "INPUT", text: cmd });
        window.javaConnector.send(msg);
      } else {
        console.warn("系統：Java 橋接器尚未就緒");
      }

      // 回顯輸入的指令到 Log 區
      appendHtml("> " + cmd, "#888");
    }

    // 將核心函數掛載到全局，方便 Java 端直接呼叫
    window.handleServerMessage = handleServerMessage;
    window.appendHtml = appendHtml;
    window.updateStats = updateStats;

    // 初始化提示
    window.onload = () => {
        appendHtml("系統：單機模式已啟動，等待 Java 核心連線...", "#aaa");
    };
  </script>
</body>
</html>