<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Modern MUD Mobile</title>
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/ansi_up@5.1.0/ansi_up.min.js"></script>
</head>
<body>

  <div class="game-container">
    <div class="status-header">
      <div>
        <div style="font-size: 12px;">HP: <span id="hp-val">0/0</span></div>
        <div class="bar-container"><div id="hp-bar" class="bar-fill hp-fill" style="width: 0%"></div></div>
      </div>
      <div>
        <div style="font-size: 12px;">MP: <span id="mp-val">0/0</span></div>
        <div class="bar-container"><div id="mp-bar" class="bar-fill mp-fill" style="width: 0%"></div></div>
      </div>
    </div>

    <div id="log"></div>

    <div class="mobile-panel">
      <div class="quick-actions">
        <button onclick="send('sc')">狀態</button>
        <button onclick="send('i')">物品</button>
        <button onclick="send('get all')">全撿</button>
        <button onclick="send('skills')">技能</button>
        <button onclick="send('rest')">休息</button>
        <button onclick="send('sit')">坐下</button>
      </div>
      <div class="direction-pad">
        <button class="dir-btn" onclick="send('nw')">↖</button>
        <button class="dir-btn" onclick="send('n')">N</button>
        <button class="dir-btn" onclick="send('ne')">↗</button>
        <button class="dir-btn" onclick="send('w')">W</button>
        <button class="dir-btn center-btn" onclick="send('l')">👁️</button>
        <button class="dir-btn" onclick="send('e')">E</button>
        <button class="dir-btn" onclick="send('sw')">↙</button>
        <button class="dir-btn" onclick="send('s')">S</button>
        <button class="dir-btn" onclick="send('se')">↘</button>
      </div>
    </div>

    <div class="input-bar">
      <input type="text" id="cmd-input" placeholder="輸入指令..." autocomplete="off" autofocus>
      <button onclick="handleEnter()" style="margin-left: 5px; padding: 0 15px;">發送</button>
    </div>
  </div>

  <script src="js/mud-core.js"></script>
  <script src="js/mud-ui.js"></script>

  <script>
    let ws = null;
    function connect() {
      const socketUrl = 'ws://localhost:8080/ws';
      ws = new WebSocket(socketUrl);
      ws.onopen = () => appendHtml("系統：連線成功！", "#00ff00");
      ws.onclose = () => {
        appendHtml("系統：連線中斷，3秒後重連...", "#ff4444");
        setTimeout(connect, 3000);
      };
      ws.onmessage = (event) => handleServerMessage(event.data);
    }

    function send(cmd) {
      if (!cmd || !ws || ws.readyState !== WebSocket.OPEN) return;
      ws.send(JSON.stringify({ type: "INPUT", text: cmd }));
      appendHtml("> " + cmd, "#888");
    }

    connect();
  </script>
</body>
</html>